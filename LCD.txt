LCD

ORG 0000H
SJMP MAIN

;LCD PORTS
LCD_DATA   EQU P2
RS         EQU P3.0
RW         EQU P3.1
EN         EQU P3.2

STAGE      EQU 30H
BOLTCOUNT  EQU 31H

MAIN:
    MOV STAGE,#01H
    MOV BOLTCOUNT,#00H

    ACALL LCD_INIT
    ACALL LCD_CLEAR

    MOV A,#'S'
    ACALL LCD_SENDDATA
    MOV A,#'T'
    ACALL LCD_SENDDATA
    MOV A,#'A'
    ACALL LCD_SENDDATA
    MOV A,#'G'
    ACALL LCD_SENDDATA
    MOV A,#'E'
    ACALL LCD_SENDDATA
    MOV A,#':'
    ACALL LCD_SENDDATA
    MOV A,#' '
    ACALL LCD_SENDDATA
    ; other texts and vars

HERE: SJMP HERE

LCD_INIT:
    MOV A,#38H   ; 8-bit, 2 line
    ACALL LCD_COMMAND
    MOV A,#0CH
    ACALL LCD_COMMAND
    MOV A,#06H
    ACALL LCD_COMMAND
    MOV A,#01H
    ACALL LCD_COMMAND
    RET

LCD_CLEAR:
    MOV A,#01H
    ACALL LCD_COMMAND
    RET

LCD_COMMAND:
    CLR RS
    CLR RW
    MOV LCD_DATA,A
    SETB EN
    ACALL DELAY
    CLR EN
    ACALL DELAY
    RET

LCD_SENDDATA:
    SETB RS
    CLR RW
    MOV LCD_DATA,A
    SETB EN
    ACALL DELAY
    CLR EN
    ACALL DELAY
    RET

DELAY:
    MOV R3,#255
D1: MOV R4,#255
D2: DJNZ R4,D2
    DJNZ R3,D1
    RET

END
